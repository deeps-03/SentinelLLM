FROM nvidia/cuda:11.8.0-devel-ubuntu22.04

# Install Python and pip
RUN apt-get update && apt-get install -y --no-install-recommends python3.10 python3.10-venv python3.10-dev python3-pip ninja-build wget && rm -rf /var/lib/apt/lists/*

# Set Python as default
RUN update-alternatives --install /usr/bin/python python /usr/bin/python3.10 1
RUN update-alternatives --install /usr/bin/pip pip /usr/bin/pip3 1

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Download the new model
RUN wget -O qwen2-1.5b-log-classifier-Q5_K_M.gguf https://huggingface.co/Deeps03/qwen2-1.5b-log-classifier/resolve/main/qwen2-1.5b-log-classifier-Q5_K_M.gguf

COPY log_consumer_model.py .
COPY xgboost_model.pkl .
COPY vectorizer.pkl .
COPY label_encoder.pkl .

CMD ["python", "log_consumer_model.py"]
